<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sistema de GestiÃ³n de LavanderÃ­a RFID</title>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>ğŸ§º</text></svg>">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="LavanderÃ­a RFID">
    <meta name="msapplication-TileColor" content="#667eea">
    <meta name="msapplication-tap-highlight" content="no">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/login.css">
</head>

<body>
    <div id="app">
        <!-- BotÃ³n de menÃº mÃ³vil -->
        <button class="mobile-menu-btn" id="mobile-menu-btn">â˜°</button>

        <!-- Overlay para mÃ³vil -->
        <div class="sidebar-overlay" id="sidebar-overlay"></div>

        <!-- Pantalla de Login -->
        <div id="login-screen" class="login-screen">
            <div class="login-container">
                <div class="login-header">
                    <div class="login-logo">ğŸ§º</div>
                    <h1 class="login-title">LavanderÃ­a RFID</h1>
                    <p class="login-subtitle">Sistema de GestiÃ³n Integral</p>
                </div>

                <div id="login-error" class="error-message" style="display: none;"></div>

                <form id="login-form" class="login-form">
                    <div class="form-group">
                        <label for="username" class="form-label">Usuario</label>
                        <input type="text" id="username" name="username" class="form-input" required
                            autocomplete="username" placeholder="Ingrese su usuario">
                    </div>
                    <div class="form-group">
                        <label for="password" class="form-label">ContraseÃ±a</label>
                        <input type="password" id="password" name="password" class="form-input" required
                            autocomplete="current-password" placeholder="Ingrese su contraseÃ±a">
                    </div>
                    <button type="submit" id="login-button" class="login-button">
                        <span id="login-text">Iniciar SesiÃ³n</span>
                    </button>
                </form>

                <div class="demo-credentials">
                    <h4>ğŸ‘¤ Credenciales de Acceso:</h4>
                    <div class="credentials-grid">
                        <div class="credential-item admin">
                            <h5>ğŸ”‘ Administrador</h5>
                            <p><strong>Usuario:</strong> <code>admin</code></p>
                            <p><strong>ContraseÃ±a:</strong> <code>admin123</code></p>
                            <small>Acceso completo a todas las funciones</small>
                        </div>
                        <div class="credential-item manager">
                            <h5>ğŸ‘” Gerente</h5>
                            <p><strong>Usuario:</strong> <code>manager</code></p>
                            <p><strong>ContraseÃ±a:</strong> <code>manager123</code></p>
                            <small>GestiÃ³n de sucursal y reportes</small>
                        </div>
                        <div class="credential-item operator">
                            <h5>âš™ï¸ Operador</h5>
                            <p><strong>Usuario:</strong> <code>operator</code></p>
                            <p><strong>ContraseÃ±a:</strong> <code>operator123</code></p>
                            <small>RecepciÃ³n y control de prendas</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pantalla Principal -->
        <div id="main-screen" class="screen">
            <!-- Sidebar Navigation -->
            <nav class="sidebar">
                <div class="sidebar-header">
                    <h2>ğŸ§º LavanderÃ­aRFID</h2>
                </div>
                
                <!-- Selector de Sucursal -->
                <div class="branch-selector" id="branch-selector" style="display: none;">
                    <label class="branch-label">ğŸ¢ Sucursal:</label>
                    <select id="current-branch" class="branch-select" onchange="app.changeBranch(this.value)">
                        <option value="">Seleccionar sucursal...</option>
                    </select>
                </div>
                
                <ul class="sidebar-menu">
                    <li><a href="#" data-page="dashboard" class="menu-item active">ğŸ“Š Dashboard</a></li>
                    <li><a href="#" data-page="clients" class="menu-item">ğŸ‘¥ Clientes</a></li>
                    <li><a href="#" data-page="reception" class="menu-item">ğŸ“¥ RecepciÃ³n</a></li>
                    <li><a href="#" data-page="control" class="menu-item">âš™ï¸ Control Interno</a></li>
                    <li><a href="#" data-page="delivery" class="menu-item">ğŸ“¤ Entrega</a></li>
            <li><a href="#" data-page="rfid-simulator" class="menu-item">ğŸ” Simulador RFID</a></li>
            <li><a href="#" data-page="notifications" class="menu-item">ğŸ“§ Notificaciones</a></li>
            <li><a href="#" data-page="history" class="menu-item">ğŸ“‹ Historial</a></li>
            <li><a href="#" data-page="reports" class="menu-item">ğŸ“ˆ Reportes</a></li>
            <li><a href="#" data-page="guides" class="menu-item">ğŸ“„ GuÃ­as</a></li>
            <li><a href="#" data-page="billing" class="menu-item">ğŸ’° FacturaciÃ³n</a></li>
            <li><a href="#" data-page="settings" class="menu-item">âš™ï¸ ConfiguraciÃ³n</a></li>
                </ul>
                <div class="sidebar-footer">
                    <div class="user-info" id="user-info">
                        <div style="padding: 12px; text-align: center; font-size: 13px;">
                            <div style="margin-bottom: 6px;">ğŸ‘¤ <strong id="user-name">Usuario</strong></div>
                            <div style="font-size: 11px; opacity: 0.8; margin-bottom: 8px;" id="user-role">Cargando...
                            </div>
                            <button id="logout-btn" onclick="window.logout()"
                                style="background: #e74c3c; color: white; border: none; padding: 6px 10px; border-radius: 4px; cursor: pointer; font-size: 11px; width: 100%;">
                                ğŸšª Cerrar SesiÃ³n
                            </button>
                        </div>
                    </div>
                </div>
            </nav>

            <!-- Main Content Area -->
            <main class="main-content">
                <div id="page-content">
                    <!-- Las pÃ¡ginas se cargarÃ¡n aquÃ­ dinÃ¡micamente -->
                </div>
            </main>
        </div>
    </div>

    <!-- Scripts - Orden de carga importante -->
    <script src="js/storage.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/navigation.js"></script>
    <script src="js/app.js"></script>
    <script src="js/dashboard.js"></script>
    <script src="js/clients.js"></script>
    <script src="js/reception.js"></script>
    <script src="js/control.js"></script>
    <script src="js/delivery.js"></script>
        <script src="js/rfid-simulator.js"></script>
        <script src="js/billing.js"></script>
        <script src="js/notifications.js"></script>
        <script src="js/pwa-notifications.js"></script>
    <script src="js/history.js"></script>
    <script src="js/reports.js"></script>
    <script src="js/guides.js"></script>
    
    <!-- PWA Service Worker Registration -->
    <script>
        // Registrar Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then((registration) => {
                        console.log('âœ… Service Worker registrado correctamente:', registration.scope);
                        
                        // Verificar actualizaciones
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // Nueva versiÃ³n disponible
                                    if (confirm('Nueva versiÃ³n disponible. Â¿Desea actualizar?')) {
                                        newWorker.postMessage({ type: 'SKIP_WAITING' });
                                        window.location.reload();
                                    }
                                }
                            });
                        });
                    })
                    .catch((error) => {
                        console.error('âŒ Error registrando Service Worker:', error);
                    });
            });
        }
        
        // Manejar instalaciÃ³n PWA
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            // Mostrar botÃ³n de instalaciÃ³n
            const installButton = document.createElement('button');
            installButton.textContent = 'ğŸ“± Instalar App';
            installButton.className = 'btn btn-primary install-pwa-btn';
            installButton.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                z-index: 1000;
                padding: 12px 20px;
                border-radius: 25px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                font-size: 14px;
                font-weight: 600;
                border: none;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                cursor: pointer;
                transition: all 0.3s ease;
            `;
            
            installButton.addEventListener('click', () => {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('âœ… Usuario aceptÃ³ la instalaciÃ³n PWA');
                    } else {
                        console.log('âŒ Usuario rechazÃ³ la instalaciÃ³n PWA');
                    }
                    deferredPrompt = null;
                    installButton.remove();
                });
            });
            
            document.body.appendChild(installButton);
            
            // Auto-ocultar despuÃ©s de 10 segundos
            setTimeout(() => {
                if (installButton.parentNode) {
                    installButton.remove();
                }
            }, 10000);
        });
        
        // Manejar instalaciÃ³n completada
        window.addEventListener('appinstalled', (evt) => {
            console.log('ğŸ‰ PWA instalada correctamente');
            // Ocultar botÃ³n de instalaciÃ³n si existe
            const installButton = document.querySelector('.install-pwa-btn');
            if (installButton) {
                installButton.remove();
            }
        });
        
        // Detectar si la app estÃ¡ ejecutÃ¡ndose como PWA
        window.addEventListener('load', () => {
            if (window.matchMedia('(display-mode: standalone)').matches || 
                window.navigator.standalone === true) {
                console.log('ğŸ“± App ejecutÃ¡ndose como PWA');
                document.body.classList.add('pwa-mode');
            }
        });
    </script>
</body>

</html>