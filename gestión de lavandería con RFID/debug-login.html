<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Login - Lavander√≠a RFID</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: Arial, sans-serif; 
            background: #f0f2f5; 
            padding: 20px;
        }
        .debug-panel {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .login-container {
            max-width: 400px;
            margin: 50px auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        button {
            width: 100%;
            padding: 12px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
        }
        button:hover {
            background: #0056b3;
        }
        .hidden {
            display: none !important;
        }
        .main-screen {
            max-width: 800px;
            margin: 20px auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
        }
        .log {
            background: #f8f9fa;
            padding: 10px;
            border-left: 4px solid #007bff;
            margin: 5px 0;
            font-family: monospace;
            font-size: 14px;
        }
        .success { border-color: #28a745; color: #155724; }
        .error { border-color: #dc3545; color: #721c24; }
        .warning { border-color: #ffc107; color: #856404; }
    </style>
</head>
<body>
    <!-- Panel de Debug -->
    <div class="debug-panel">
        <h2>üîç Panel de Diagn√≥stico</h2>
        <div id="debug-logs">
            <div class="log">üöÄ Sistema iniciando...</div>
        </div>
        <button onclick="clearLogs()">üóëÔ∏è Limpiar Logs</button>
        <button onclick="checkSystem()">üîß Verificar Sistema</button>
    </div>

    <!-- Pantalla de Login -->
    <div id="login-screen" class="login-container">
        <h1>üß∫ Debug Login</h1>
        <p>Sistema de diagn√≥stico de login</p>
        
        <form id="login-form">
            <div class="form-group">
                <label for="username">Usuario:</label>
                <input type="text" id="username" value="admin" required>
            </div>
            <div class="form-group">
                <label for="password">Contrase√±a:</label>
                <input type="password" id="password" value="admin123" required>
            </div>
            <button type="submit">üîê Iniciar Sesi√≥n</button>
        </form>
        
        <div style="margin-top: 15px; font-size: 14px; color: #666;">
            <strong>Demo:</strong> admin / admin123
        </div>
    </div>

    <!-- Pantalla Principal -->
    <div id="main-screen" class="main-screen hidden">
        <h1>‚úÖ ¬°Login Exitoso!</h1>
        <p>Has ingresado correctamente al sistema.</p>
        <div style="margin: 20px 0;">
            <div style="background: #d4edda; padding: 15px; border-radius: 5px; margin: 10px 0;">
                <strong>Usuario:</strong> <span id="current-user">-</span>
            </div>
            <div style="background: #d1ecf1; padding: 15px; border-radius: 5px; margin: 10px 0;">
                <strong>Hora de login:</strong> <span id="login-time">-</span>
            </div>
        </div>
        <button onclick="logout()">üö™ Cerrar Sesi√≥n</button>
        <button onclick="testFeatures()">üß™ Probar Funciones</button>
    </div>

    <script>
        // SISTEMA DE DEBUG ULTRA-SIMPLE
        let debugMode = true;
        let currentUser = null;
        
        function log(message, type = 'info') {
            console.log(`[${type.toUpperCase()}] ${message}`);
            
            if (debugMode) {
                const debugLogs = document.getElementById('debug-logs');
                const logElement = document.createElement('div');
                logElement.className = `log ${type}`;
                logElement.innerHTML = `${new Date().toLocaleTimeString()} - ${message}`;
                debugLogs.appendChild(logElement);
                debugLogs.scrollTop = debugLogs.scrollHeight;
            }
        }
        
        function clearLogs() {
            document.getElementById('debug-logs').innerHTML = '<div class="log">üóëÔ∏è Logs limpiados</div>';
        }
        
        function checkSystem() {
            log('üîß Verificando sistema...', 'warning');
            log(`DOM: ${document.readyState}`, 'info');
            log(`Usuario actual: ${currentUser ? currentUser.name : 'null'}`, 'info');
            log(`Login screen visible: ${!document.getElementById('login-screen').classList.contains('hidden')}`, 'info');
            log(`Main screen visible: ${!document.getElementById('main-screen').classList.contains('hidden')}`, 'info');
            log(`LocalStorage items: ${localStorage.length}`, 'info');
            log('‚úÖ Verificaci√≥n completa', 'success');
        }
        
        // Inicializaci√≥n cuando el DOM est√© listo
        document.addEventListener('DOMContentLoaded', function() {
            log('üì± DOM cargado completamente', 'success');
            
            // Configurar evento del formulario
            const loginForm = document.getElementById('login-form');
            if (loginForm) {
                loginForm.addEventListener('submit', handleLogin);
                log('‚úÖ Evento de login configurado', 'success');
            } else {
                log('‚ùå No se encontr√≥ el formulario de login', 'error');
            }
            
            // Verificar si hay sesi√≥n existente
            checkExistingSession();
            
            log('üéØ Sistema inicializado correctamente', 'success');
        });
        
        function checkExistingSession() {
            log('üîç Verificando sesi√≥n existente...', 'info');
            
            const savedUser = localStorage.getItem('current_user');
            if (savedUser) {
                try {
                    currentUser = JSON.parse(savedUser);
                    log(`üë§ Usuario encontrado: ${currentUser.name}`, 'success');
                    showMainScreen();
                } catch (error) {
                    log(`‚ùå Error al cargar usuario: ${error.message}`, 'error');
                    localStorage.removeItem('current_user');
                }
            } else {
                log('üë§ No hay sesi√≥n activa', 'info');
            }
        }
        
        function handleLogin(event) {
            event.preventDefault();
            
            log('üîë Iniciando proceso de login...', 'info');
            
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();
            
            log(`üìù Usuario ingresado: "${username}"`, 'info');
            log(`üìù Contrase√±a ingresada: "${password.replace(/./g, '*')}"`, 'info');
            
            // Validar credenciales
            if (validateCredentials(username, password)) {
                log('‚úÖ Credenciales v√°lidas', 'success');
                
                const user = {
                    id: 1,
                    username: username,
                    name: username === 'admin' ? 'Administrador' : 'Operador',
                    role: 'admin',
                    loginTime: new Date().toISOString()
                };
                
                log(`üë§ Usuario creado: ${JSON.stringify(user)}`, 'info');
                
                // Guardar en localStorage
                try {
                    localStorage.setItem('current_user', JSON.stringify(user));
                    log('üíæ Usuario guardado en localStorage', 'success');
                } catch (error) {
                    log(`‚ùå Error guardando en localStorage: ${error.message}`, 'error');
                    return;
                }
                
                currentUser = user;
                
                log('üîÑ Iniciando transici√≥n a pantalla principal...', 'info');
                
                // Mostrar pantalla principal
                setTimeout(() => {
                    showMainScreen();
                }, 100);
                
            } else {
                log('‚ùå Credenciales incorrectas', 'error');
                alert('‚ùå Credenciales incorrectas\n\nUsa: admin / admin123');
            }
        }
        
        function validateCredentials(username, password) {
            const isValid = (username === 'admin' && password === 'admin123') ||
                           (username === 'operador' && password === 'op123');
            
            log(`üîê Validaci√≥n de credenciales: ${isValid ? 'EXITOSA' : 'FALLIDA'}`, isValid ? 'success' : 'error');
            
            return isValid;
        }
        
        function showMainScreen() {
            log('üñ•Ô∏è Ejecutando showMainScreen()...', 'info');
            
            const loginScreen = document.getElementById('login-screen');
            const mainScreen = document.getElementById('main-screen');
            
            if (!loginScreen) {
                log('‚ùå No se encontr√≥ login-screen', 'error');
                return;
            }
            
            if (!mainScreen) {
                log('‚ùå No se encontr√≥ main-screen', 'error');
                return;
            }
            
            log('üì± Elementos encontrados, aplicando transici√≥n...', 'info');
            
            // Ocultar login
            loginScreen.classList.add('hidden');
            log('üëÅÔ∏è Login screen ocultado', 'success');
            
            // Mostrar main
            mainScreen.classList.remove('hidden');
            log('üëÅÔ∏è Main screen mostrado', 'success');
            
            // Actualizar informaci√≥n de usuario
            if (currentUser) {
                const userSpan = document.getElementById('current-user');
                const timeSpan = document.getElementById('login-time');
                
                if (userSpan) {
                    userSpan.textContent = currentUser.name;
                    log('üë§ Nombre de usuario actualizado en UI', 'success');
                }
                
                if (timeSpan) {
                    timeSpan.textContent = new Date(currentUser.loginTime).toLocaleString('es-ES');
                    log('‚è∞ Hora de login actualizada en UI', 'success');
                }
            }
            
            log('üéâ Transici√≥n a pantalla principal COMPLETADA', 'success');
        }
        
        function logout() {
            log('üö™ Iniciando logout...', 'info');
            
            // Limpiar datos
            localStorage.removeItem('current_user');
            currentUser = null;
            
            // Mostrar login, ocultar main
            document.getElementById('login-screen').classList.remove('hidden');
            document.getElementById('main-screen').classList.add('hidden');
            
            // Limpiar formulario
            document.getElementById('username').value = 'admin';
            document.getElementById('password').value = 'admin123';
            
            log('‚úÖ Logout completado', 'success');
        }
        
        function testFeatures() {
            log('üß™ Ejecutando pruebas del sistema...', 'warning');
            
            const tests = [
                () => localStorage.setItem('test', 'ok') && localStorage.getItem('test') === 'ok',
                () => document.getElementById('main-screen') !== null,
                () => currentUser !== null,
                () => typeof showMainScreen === 'function'
            ];
            
            tests.forEach((test, index) => {
                try {
                    const result = test();
                    log(`Test ${index + 1}: ${result ? 'PASS' : 'FAIL'}`, result ? 'success' : 'error');
                } catch (error) {
                    log(`Test ${index + 1}: ERROR - ${error.message}`, 'error');
                }
            });
            
            localStorage.removeItem('test');
            log('üéØ Pruebas completadas', 'info');
        }
        
        // Log inicial
        log('üöÄ Script cargado, esperando DOM...', 'info');
    </script>
</body>
</html>


